<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>My heart belongs only to Trvu.</title>

<style>
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: black;
    overflow: hidden;
}

canvas {
    position: absolute;
    width: 100%;
    height: 100%;
}

.center-text {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-style: italic;
    color: #ff4fa7;
    pointer-events: none;
    text-align: center;
    z-index: 5;
}
</style>
</head>

<body>

<canvas id="heartCanvas"></canvas>
<div class="center-text">Vũ Thu Trang</div>

<script>
/* ================== HEART PARTICLE ================== */
var settings = {
    particles: {
        length: 3000,
        duration: 2.5,
        velocity: 90,
        effect: -1.2,
        size: 12
    }
};

(function(){
    let last = 0;
    let vendors = ["ms","moz","webkit","o"];
    for(let x=0;x<vendors.length&&!window.requestAnimationFrame;x++){
        window.requestAnimationFrame = window[vendors[x]+"RequestAnimationFrame"];
    }
    if(!window.requestAnimationFrame){
        window.requestAnimationFrame=function(cb){
            let now = Date.now();
            let next = Math.max(0,16-(now-last));
            let id = setTimeout(()=>cb(now+next), next);
            last = now+next;
            return id;
        }
    }
})();

function Point(x,y){this.x=x||0;this.y=y||0;}
Point.prototype.clone=function(){return new Point(this.x,this.y);}
Point.prototype.length=function(l){
    if(l===undefined) return Math.sqrt(this.x*this.x+this.y*this.y);
    this.normalize(); this.x*=l; this.y*=l; return this;
}
Point.prototype.normalize=function(){
    let l=this.length(); this.x/=l; this.y/=l; return this;
}

function Particle(){
    this.pos=new Point();
    this.vel=new Point();
    this.acc=new Point();
    this.age=0;
}
Particle.prototype.init=function(x,y,dx,dy){
    this.pos.x=x; this.pos.y=y;
    this.vel.x=dx; this.vel.y=dy;
    this.acc.x=dx*settings.particles.effect;
    this.acc.y=dy*settings.particles.effect;
    this.age=0;
}
Particle.prototype.update=function(dt){
    this.pos.x+=this.vel.x*dt;
    this.pos.y+=this.vel.y*dt;
    this.vel.x+=this.acc.x*dt;
    this.vel.y+=this.acc.y*dt;
    this.age+=dt;
}
Particle.prototype.draw=function(ctx,img){
    let t=this.age/settings.particles.duration;
    let size=img.width*((--t)*t*t+1);
    ctx.globalAlpha=1-this.age/settings.particles.duration;
    ctx.drawImage(img,this.pos.x-size/2,this.pos.y-size/2,size,size);
}

function Pool(n){
    this.p=[]; this.a=0; this.f=0;
    for(let i=0;i<n;i++) this.p[i]=new Particle();
}
Pool.prototype.add=function(x,y,dx,dy){
    this.p[this.f].init(x,y,dx,dy);
    this.f=(this.f+1)%this.p.length;
    if(this.f===this.a) this.a=(this.a+1)%this.p.length;
}
Pool.prototype.update=function(dt){
    while(this.a!==this.f && this.p[this.a].age>=settings.particles.duration)
        this.a=(this.a+1)%this.p.length;
    for(let i=this.a;i!==this.f;i=(i+1)%this.p.length)
        this.p[i].update(dt);
}
Pool.prototype.draw=function(ctx,img){
    for(let i=this.a;i!==this.f;i=(i+1)%this.p.length)
        this.p[i].draw(ctx,img);
}

const canvas=document.getElementById("heartCanvas");
const ctx=canvas.getContext("2d");
let pool=new Pool(settings.particles.length);
let rate=settings.particles.length/settings.particles.duration;
let time=0;

function heart(t){
    return new Point(
        160*Math.pow(Math.sin(t),3),
        130*Math.cos(t)-50*Math.cos(2*t)-20*Math.cos(3*t)-10*Math.cos(4*t)+25
    );
}

let img=(function(){
    let c=document.createElement("canvas");
    let x=c.getContext("2d");
    c.width=c.height=settings.particles.size;
    x.fillStyle="#ff5ca4";
    x.beginPath();
    for(let t=-Math.PI;t<Math.PI;t+=0.02){
        let p=heart(t);
        x.lineTo(
            c.width/2+p.x*c.width/350,
            c.height/2-p.y*c.height/350
        );
    }
    x.fill();
    let i=new Image(); i.src=c.toDataURL();
    return i;
})();

function resize(){
    canvas.width=innerWidth;
    canvas.height=innerHeight;
}
window.onresize=resize;
resize();

(function render(){
    requestAnimationFrame(render);
    let now=Date.now()/1000;
    let dt=now-(time||now);
    time=now;
    ctx.clearRect(0,0,canvas.width,canvas.height);

    for(let i=0;i<rate*dt;i++){
        let p=heart(Math.random()*Math.PI*2);
        let d=p.clone().length(settings.particles.velocity);
        pool.add(canvas.width/2+p.x,canvas.height/2-p.y,d.x,-d.y);
    }
    pool.update(dt);
    pool.draw(ctx,img);
})();
</script>

<!-- ================== HEART CURSOR ================== -->
<script>
var colours=['#f06','#f39','#f9c','#ff5ca4'];
var hearts=80, mini=10, maxi=20;
var x=0,y=0,ox=0,oy=0,herz=[],hx=[],hy=[],hs=[];
document.onmousemove=e=>{x=e.pageX;y=e.pageY};

for(let i=0;i<hearts;i++){
    let d=document.createElement("div");
    d.style.position="absolute";
    d.style.color=colours[i%colours.length];
    d.style.pointerEvents="none";
    d.style.visibility="hidden";
    d.innerHTML="❤";
    document.body.appendChild(d);
    herz[i]=d;
}

setInterval(()=>{
    if(Math.abs(x-ox)>5||Math.abs(y-oy)>5){
        ox=x; oy=y;
        for(let i=0;i<hearts;i++) if(!hy[i]){
            herz[i].style.left=(hx[i]=x)+"px";
            herz[i].style.top=(hy[i]=y)+"px";
            herz[i].style.fontSize=(hs[i]=mini)+"px";
            herz[i].style.visibility="visible";
            break;
        }
    }
    for(let i=0;i<hearts;i++) if(hy[i]){
        hy[i]-=2; hx[i]+=Math.random()*2-1;
        hs[i]+=0.3;
        if(hy[i]<0){hy[i]=0;herz[i].style.visibility="hidden";}
        herz[i].style.top=hy[i]+"px";
        herz[i].style.left=hx[i]+"px";
        herz[i].style.fontSize=hs[i]+"px";
    }
},30);
</script>

</body>
</html>
