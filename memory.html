<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Love Thu Trang</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}

html,body{
  width:100%;
  height:100%;
  overflow:hidden;
  font-family:"Segoe UI",sans-serif;
  background:#060006;
}

/* ===== BACKGROUND EFFECT ===== */
body::before{
  content:"";
  position:fixed;
  inset:0;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,80,120,.12), transparent 45%),
    radial-gradient(circle at 70% 70%, rgba(180,80,255,.10), transparent 50%),
    linear-gradient(180deg,#060006,#0a0208);
  animation:bgMove 20s linear infinite;
  z-index:0;
}
@keyframes bgMove{
  from{filter:hue-rotate(0deg)}
  to{filter:hue-rotate(12deg)}
}

/* ===== UNLOCK LAYER (FIX MOBILE AUTOPLAY) ===== */
#unlock{
  position:fixed;
  inset:0;
  z-index:20;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.35);
  backdrop-filter:blur(4px);
  color:#ffd6e6;
  font-size:14px;
  letter-spacing:.15em;
  animation:pulse 2s infinite;
}
@keyframes pulse{
  0%,100%{opacity:.6}
  50%{opacity:1}
}

/* THREE CANVAS */
canvas{
  position:fixed;
  inset:0;
  width:100vw;
  height:100vh;
  z-index:1;
}

/* FALL LAYER */
#fall-layer{
  position:fixed;
  inset:0;
  z-index:5;
  pointer-events:none;
}

.fall{
  position:absolute;
  top:-10%;
  white-space:nowrap;
  animation:fall linear infinite;
  opacity:.9;
}

.text{
  color:rgba(255,190,210,0.95);
  text-shadow:0 0 14px rgba(255,120,160,0.6);
  letter-spacing:.18em;
}

@keyframes fall{
  from{transform:translateY(-10vh);opacity:0}
  to{transform:translateY(110vh);opacity:1}
}
</style>
</head>

<body>

<!-- ===== MOBILE UNLOCK ===== -->
<div id="unlock">I Love You - ThuTrang</div>

<!-- ===== AUDIO ===== -->
<audio id="bgm" loop playsinline preload="auto">
  <source src="https://files.catbox.moe/39ugmx.mp3" type="audio/mpeg">
</audio>

<canvas id="c"></canvas>
<div id="fall-layer"></div>

<script type="module">
import * as THREE from "https://cdn.skypack.dev/three@0.135.0";
import { GLTFLoader } from "https://cdn.skypack.dev/three@0.135.0/examples/jsm/loaders/GLTFLoader";
import { gsap } from "https://cdn.skypack.dev/gsap@3.8.0";

/* ===== MUSIC FIX ALL ===== */
const bgm=document.getElementById("bgm");
let volume=0;
const maxVolume=0.5;

function startMusic(){
  bgm.volume=0;
  bgm.play().then(()=>{
    const fade=setInterval(()=>{
      volume+=0.02;
      bgm.volume=Math.min(volume,maxVolume);
      if(volume>=maxVolume) clearInterval(fade);
    },60);
  }).catch(()=>{});
}

const unlock=document.getElementById("unlock");
unlock.addEventListener("pointerdown",()=>{
  unlock.remove();
  startMusic();
},{once:true});

/* ===== THREE SCENE ===== */
const canvas=document.getElementById("c");
const scene=new THREE.Scene();
scene.background=new THREE.Color("#0a0206");

const camera=new THREE.PerspectiveCamera(70,innerWidth/innerHeight,0.1,100);
camera.position.z=4.5;

const renderer=new THREE.WebGLRenderer({canvas,antialias:true});
renderer.setSize(innerWidth,innerHeight);
renderer.setPixelRatio(Math.min(devicePixelRatio,1.4));

window.addEventListener("resize",()=>{
  camera.aspect=innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});

scene.add(new THREE.AmbientLight(0xffffff,1));

/* ===== HEART ===== */
let heartModel;
let baseScale=0.38;

new GLTFLoader().load(
  "https://assets.codepen.io/74321/heart.glb",
  g=>{
    heartModel=g.scene.children[0];
    heartModel.scale.set(0.01,0.01,0.01);
    heartModel.material=new THREE.MeshMatcapMaterial({
      matcap:new THREE.TextureLoader().load(
        "https://assets.codepen.io/74321/3.png"
      )
    });
    scene.add(heartModel);

    gsap.to(heartModel.scale,{
      x:baseScale,y:baseScale,z:baseScale,
      duration:1.6,
      ease:"elastic.out(1,0.5)"
    });
  }
);

/* ===== FALLING HEARTS ===== */
const heartTex=new THREE.TextureLoader().load(
  "https://assets.codepen.io/74321/heart.png"
);

const count=innerWidth<600?60:120;
const geo=new THREE.BufferGeometry();
const pos=new Float32Array(count*3);
const speed=[];

for(let i=0;i<count;i++){
  pos[i*3]=(Math.random()-0.5)*8;
  pos[i*3+1]=Math.random()*8;
  pos[i*3+2]=(Math.random()-0.5)*2;
  speed[i]=0.006+Math.random()*0.01;
}
geo.setAttribute("position",new THREE.BufferAttribute(pos,3));

scene.add(new THREE.Points(
  geo,
  new THREE.PointsMaterial({
    size:0.18,
    map:heartTex,
    transparent:true,
    opacity:0.45,
    depthWrite:false
  })
));

/* ===== FALL TEXT ===== */
const layer=document.getElementById("fall-layer");
const texts=[
  "love thu trang","vÅ© thu trang","05 Â· 03 Â· 2011",
  "I Love You","I Miss You","Now and forever?...","vÅ© thu trang",
  "05 Â· 03 Â· 2011","I Love You","I Miss You","trvu","Thu Trang",
  "luv u"
];
const emojis=["ðŸ’•","ðŸ’–","ðŸŒ¸","ðŸ’ž","âœ¨","ðŸ’˜","â¤ï¸â€ðŸ”¥","ðŸ’"];

function spawnFall(){
  const el=document.createElement("div");
  el.className="fall";
  if(Math.random()<0.25){
    el.textContent=texts[Math.floor(Math.random()*texts.length)];
    el.classList.add("text");
    el.style.fontSize=(14+Math.random()*12)+"px";
  }else{
    el.textContent=emojis[Math.floor(Math.random()*emojis.length)];
    el.style.fontSize=(16+Math.random()*18)+"px";
  }
  el.style.left=Math.random()*100+"%";
  el.style.animationDuration=(7+Math.random()*7)+"s";
  layer.appendChild(el);
  setTimeout(()=>el.remove(),16000);
}
setInterval(spawnFall,180);

/* ===== LOOP ===== */
function animate(){
  if(heartModel){
    heartModel.rotation.y+=0.003;
    const pulse=1+Math.sin(performance.now()*0.006)*0.02;
    heartModel.scale.set(
      baseScale*pulse,
      baseScale*pulse,
      baseScale*pulse
    );
  }

  const a=geo.attributes.position.array;
  for(let i=0;i<count;i++){
    a[i*3+1]-=speed[i];
    if(a[i*3+1]<-4){
      a[i*3+1]=4;
      a[i*3]=(Math.random()-0.5)*8;
    }
  }
  geo.attributes.position.needsUpdate=true;

  renderer.render(scene,camera);
  requestAnimationFrame(animate);
}
animate();
</script>

</body>
</html>
